<div id="modal" class="fixed inset-0 bg-black/50 flex items-center justify-center">
  <div class="bg-[var(--card-bg)] p-4 rounded shadow min-w-[20rem]">
    <h1 class="text-xl mb-4">Upload Image</h1>
    <form id="upload-image-form" hx-target="#modal" hx-swap="outerHTML" hx-encoding="multipart/form-data" enctype="multipart/form-data" method="post">
      <div class="mb-2">
        <label class="block mb-1">Category</label>
        <select id="img-category" class="rounded bg-[var(--input-bg)] text-[var(--input-text)] border border-[var(--border-color)] px-2 py-1">
          <option value="menu">Menu Item</option>
          <option value="device">Device Type</option>
        </select>
      </div>
      <div class="mb-2">
        <label class="block mb-1">Item</label>
        <select id="img-item" class="rounded bg-[var(--input-bg)] text-[var(--input-text)] border border-[var(--border-color)] px-2 py-1">
          {% for label, slug in menu_items %}
          <option value="{{ slug }}" data-cat="menu">{{ label }}</option>
          {% endfor %}
          {% for dt in device_types %}
          <option value="{{ dt.id }}" data-cat="device">{{ dt.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-2">
        <label class="block">Icon</label>
        <input type="file" name="icon" accept="image/*" class="text-[var(--input-text)]">
      </div>
      <div class="mb-2">
        <label class="block">Image</label>
        <input type="file" name="image" accept="image/*" class="text-[var(--input-text)]">
      </div>
      <div class="text-right mt-2">
        <button type="submit" class="px-3 py-1 bg-[var(--btn-bg)] hover:bg-[var(--btn-hover)] text-[var(--btn-text)] rounded">Save</button>
        <button type="button" class="px-3 py-1 ml-2 bg-[var(--btn-bg)] hover:bg-[var(--btn-hover)] text-[var(--btn-text)] rounded" onclick="document.getElementById('modal').innerHTML=''">Cancel</button>
      </div>
    </form>
  </div>
</div>
<script>
function updateUploadImageForm() {
  const cat = document.getElementById('img-category').value;
  const itemSelect = document.getElementById('img-item');
  for (const opt of itemSelect.options) {
    opt.hidden = opt.dataset.cat !== cat;
  }
  const visible = Array.from(itemSelect.options).find(o => !o.hidden);
  if (visible) { itemSelect.value = visible.value; }
  const form = document.getElementById('upload-image-form');
  form.setAttribute('hx-post', `/admin/upload-image/${cat}/${itemSelect.value}`);
}
updateUploadImageForm();
document.getElementById('img-category').addEventListener('change', updateUploadImageForm);
document.getElementById('img-item').addEventListener('change', updateUploadImageForm);
</script>

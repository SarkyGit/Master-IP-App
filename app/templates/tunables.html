{% extends "base.html" %}

{% block content %}
<h1 class="text-xl mb-4">System Tunables</h1>
<p class="mb-3 text-base text-[var(--card-text)]">Current Version: <span class="fw-bold">{{ version }}</span></p>
{% if current_user and current_user.role == 'superadmin' %}
<p class="mb-3"><a href="/admin/logo" class="underline">Upload Logo</a></p>
{% endif %}

<div x-data="{tab:0, ready:false}" x-init="setTimeout(() => ready = true, 50)">
  <ul class="flex border-b" >
    {% for function in groups.keys() %}
    <li class="mr-2">
      <button @click="tab={{ loop.index0 }}" :class="{'border-b-2': tab==={{ loop.index0 }} }" class="px-3 py-2">{{ function }}</button>
    </li>
    {% endfor %}
  </ul>

  {% for function, files in groups.items() %}
  <div x-show="ready && tab==={{ loop.index0 }}" x-transition.opacity.duration.150ms class="mt-3" x-cloak>
    {% for file, tunables in files.items() %}
    <h3 class="mt-2">{{ file }}</h3>
      {% for tunable in tunables %}
        <form method="post" action="/tunables/{{ tunable.id }}" class="mb-3 p-3 border rounded">
          <div class="flex flex-wrap gap-4 items-start">
            <div class="flex flex-col flex-1 min-w-[280px]">
              <label class="mb-1 fw-bold block">{{ tunable.name }}</label>
              {% if tunable.description %}
              <p class="text-sm text-gray-400">{{ tunable.description }}</p>
              {% endif %}
              {% if tunable.options and tunable.data_type == 'choice' %}
              <p class="text-sm text-gray-400">Options: {{ tunable.options }}</p>
              {% endif %}
            </div>
            <div class="flex flex-col flex-1 min-w-[280px]">
              {% if tunable.data_type == 'bool' %}
              <input type="checkbox" name="value" value="true" {% if tunable.value == 'true' %}checked{% endif %}>
              {% elif tunable.data_type == 'choice' %}
              <select name="value" class="rounded bg-[var(--input-bg)] text-[var(--input-text)] border border-[var(--border-color)]">
                {% for opt in tunable.options.split(',') %}
                <option value="{{ opt }}" {% if tunable.value == opt %}selected{% endif %}>{{ opt }}</option>
                {% endfor %}
              </select>
              {% else %}
              <input type="text" name="value" value="{{ tunable.value }}" class="rounded bg-[var(--input-bg)] text-[var(--input-text)] border border-[var(--border-color)]">
              {% endif %}
            </div>
          </div>
          <button type="submit" class="mt-3 btn">Save</button>
        </form>
      {% endfor %}
    {% endfor %}
  </div>
  {% endfor %}
</div>

{% endblock %}

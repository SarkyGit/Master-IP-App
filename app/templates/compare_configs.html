{% extends "base.html" %}

{% block content %}
<h1 class="text-xl mb-4">Compare Configs</h1>
<form method="get" class="mb-4">
  <label for="device_id" class="me-2">Device:</label>
  <select name="device_id" id="device_id" onchange="this.form.submit()" class="form-select d-inline w-auto">
    {% for dev in devices %}
    <option value="{{ dev.id }}" {% if device and dev.id == device.id %}selected{% endif %}>{{ dev.hostname }}</option>
    {% endfor %}
  </select>
  {% if device %}
  <label for="backup_a" class="ms-4 me-2">Config A:</label>
  <select name="backup_a" id="backup_a" class="form-select d-inline w-auto">
    {% for b in backups %}
    <option value="{{ b.id }}" {% if b.id == backup_a %}selected{% endif %}>{{ b.created_at }}</option>
    {% endfor %}
  </select>
  <label for="backup_b" class="ms-4 me-2">Config B:</label>
  <select name="backup_b" id="backup_b" class="form-select d-inline w-auto">
    {% for b in backups %}
    <option value="{{ b.id }}" {% if b.id == backup_b %}selected{% endif %}>{{ b.created_at }}</option>
    {% endfor %}
  </select>
  <button type="submit" class="btn btn-primary ms-2">Compare</button>
  {% endif %}
</form>
{% if device %}
<p class="mb-2">Device type: <span class="badge bg-secondary">{{ device.device_type.name }}</span></p>
{% endif %}
{% if diff_table %}
<div class="overflow-auto">
  {{ diff_table | safe }}
</div>
{% elif backup_a and backup_b %}
<p class="text-red-500">Unable to load selected configs.</p>
{% endif %}
{% endblock %}

{% extends "base.html" %}

{% block content %}
<h1 class="text-xl mb-2">Port Status for {{ device.hostname }}</h1>
<a href="/devices" class="underline inline-block mb-4">Back to Devices</a>
{% if error %}
  <p class="text-red-500 mb-4">{{ error }}</p>
{% endif %}
<div class="space-y-1 mb-4">
  {% for row in port_rows %}
  <div class="grid grid-cols-{{ row|length }} gap-1 justify-center">
    {% for port in row %}
      <div
        id="port-{{ port.name|replace('/', '-') }}"
        class="w-20 h-12 flex flex-col items-center justify-center text-xs text-white {% if port.oper_status == 'up' %}bg-green-600{% else %}bg-red-600{% endif %}"
        title="{{ port.descr or port.name }}"
      >
        <span>{{ port.name }}</span>
        <span class="port-rate">--</span>
      </div>
    {% endfor %}
  </div>
  {% endfor %}
</div>
{% if virtual_ports %}
<hr class="my-4">
<h2 class="text-lg mb-2">Virtual Ports</h2>
<div class="flex flex-wrap gap-1 mb-4">
  {% for port in virtual_ports %}
    <div
      id="port-{{ port.name|replace('/', '-') }}"
      class="w-20 h-12 flex flex-col items-center justify-center text-xs text-white {% if port.oper_status == 'up' %}bg-green-600{% else %}bg-red-600{% endif %}"
      title="{{ port.descr or port.name }}"
    >
      <span>{{ port.name }}</span>
      <span class="port-rate">--</span>
    </div>
  {% endfor %}
</div>
{% endif %}
<table class="min-w-full bg-black">
  <thead>
    <tr>
      <th class="px-4 py-2 text-left">Port Name</th>
      <th class="px-4 py-2 text-left">Status</th>
      <th class="px-4 py-2 text-left">Admin State</th>
      <th class="px-4 py-2 text-left">Speed</th>
      <th class="px-4 py-2 text-left">Description</th>
      <th class="px-4 py-2 text-left">Actions</th>
    </tr>
  </thead>
  <tbody>
  {% for port in ports %}
    <tr class="border-t border-white">
      <td class="px-4 py-2">{{ port.name or port.descr }}</td>
      <td class="px-4 py-2">
        {% if port.oper_status == 'up' %}
          <span class="text-green-400">up</span>
        {% else %}
          <span class="text-red-400">down</span>
        {% endif %}
      </td>
      <td class="px-4 py-2">{{ port.admin_status }}</td>
      <td class="px-4 py-2">{{ port.speed or '' }} Mbps</td>
      <td class="px-4 py-2">{{ port.alias or '' }}</td>
      <td class="px-4 py-2">
        <a href="/devices/{{ device.id }}/ports/{{ port.name }}/config" class="text-blue-400 underline">Config</a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block extra_scripts %}
<script>window.deviceId = {{ device.id }};</script>
<script src="/static/js/port_status.js"></script>
{% endblock %}

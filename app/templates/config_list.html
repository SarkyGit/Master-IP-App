{% extends "base.html" %}

{% block content %}
<h1 class="text-xl mb-4">Config Backups for {{ device.hostname }}</h1>
<p><a href="/compare-configs?device_id={{ device.id }}" class="text-blue-400 underline">Compare</a></p>
{% if device.last_snmp_check %}
<p class="mb-4">
  {% if device.snmp_reachable %}
    <span class="text-green-400">●</span>
  {% else %}
    <span class="text-red-400">●</span>
  {% endif %}
  Uptime: {{ device.uptime_seconds | format_uptime }}
  (checked {{ device.last_snmp_check }})
</p>
{% endif %}
<table class="min-w-full text-left">
  <thead>
    <tr>
      <th class="px-4 py-2 text-left">Timestamp</th>
      <th class="px-4 py-2 text-left">Source</th>
      <th class="px-4 py-2 text-left">Status</th>
      <th class="px-4 py-2 text-left">Diff</th>
      <th class="px-4 py-2 text-left">Config</th>
    </tr>
  </thead>
  <tbody>
  {% for backup in backups %}
    <tr class="border-t border-gray-700">
      <td class="px-4 py-2">{{ backup.created_at }}</td>
      <td class="px-4 py-2">
        {% if backup.source == 'bulk_vlan_push' %}
          <span title="Bulk VLAN Push">bulk_vlan_push</span>
        {% else %}
          {{ backup.source }}
        {% endif %}
      </td>
      <td class="px-4 py-2">
        {% if backup.queued %}
          <span class="text-yellow-400">Pending</span>
        {% elif backup.status == 'failed' %}
          <span class="text-red-400">Failed</span>
        {% else %}
          <span class="text-green-400">Pushed</span>
        {% endif %}
      </td>
      <td class="px-4 py-2">
        {% if not loop.last %}
        <a href="/configs/{{ backup.id }}/diff" class="text-blue-400 underline">View Diff</a>
        {% else %}
        N/A
        {% endif %}
      </td>
      <td class="px-4 py-2" x-data="{open:false}">
        <button class="text-blue-400 underline" @click="open = true">View Config</button>
        <div x-show="open" class="fixed inset-0 bg-black bg-opacity-50 flex justify-end" x-cloak>
          <div class="bg-gray-800 w-1/2 p-4">
            <div class="flex justify-between items-center border-b border-gray-700 pb-2">
              <h5>Config from {{ backup.created_at }}</h5>
              <button @click="open = false" class="text-white">✕</button>
            </div>
            <div class="mt-2">
              <pre class="bg-black p-2 whitespace-pre-wrap overflow-auto">{{ backup.config_text }}</pre>
            </div>
          </div>
        </div>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}

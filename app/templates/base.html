<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}CES Inventory{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    {% set theme = (current_user.theme if current_user else 'dark') if current_user is defined else 'dark' %}
    {% set font = (current_user.font if current_user else 'sans') if current_user is defined else 'sans' %}
    <link rel="stylesheet" href="/static/themes/{{ theme }}.css">
    <link rel="stylesheet" href="/static/fonts/{{ font }}.css">
  </head>
  <body>
    <header>
      {% block nav %}
      <nav class="bg-gray-800 text-white">
        <div class="container mx-auto flex flex-wrap items-center justify-between" x-data="{open:false}">
          <a class="font-bold" href="/">CES Inventory</a>
          <button @click="open = !open" class="lg:hidden p-2">â˜°</button>
          <div :class="{'block': open, 'hidden': !open}" class="w-full lg:block lg:w-auto">
            <ul class="lg:flex lg:space-x-4">
              <li class="py-1">
                <a class="block px-4 py-2 text-blue-400 rounded hover:underline" href="/">Home</a>
              </li>
              <li class="relative py-1" x-data="{open:false}">
                <button @click="open = !open" class="block px-4 py-2 text-blue-400 rounded hover:underline">Inventory</button>
                <ul x-show="open" @click.away="open = false" class="absolute mt-2 bg-gray-800 text-white py-2 w-48 hidden" x-cloak>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/devices">All Devices</a></li>
                  {% for dtype in get_device_types() %}
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/devices/type/{{ dtype.id }}">{{ dtype.name }}</a></li>
                  {% endfor %}
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/inventory/audit">Audit</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/inventory/trailers">Trailer Inventory</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/inventory/sites">Site Inventory</a></li>
                </ul>
              </li>
              <li class="relative py-1" x-data="{open:false}">
                <button @click="open = !open" class="block px-4 py-2 text-blue-400 rounded hover:underline">Network</button>
                <ul x-show="open" @click.away="open = false" class="absolute mt-2 bg-gray-800 text-white py-2 w-48 hidden" x-cloak>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/network/ip-search">IP Search</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/vlans">VLAN MGMT</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/network/port-configs">Port Configs</a></li>
                </ul>
              </li>
              <li class="relative py-1" x-data="{open:false}">
                <button @click="open = !open" class="block px-4 py-2 text-blue-400 rounded hover:underline">Tasks</button>
                <ul x-show="open" @click.away="open = false" class="absolute mt-2 bg-gray-800 text-white py-2 w-48 hidden" x-cloak>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/tasks">Task Queue</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/devices/duplicates">Duplicate Checker</a></li>
                  {% if current_user and current_user.role in ['admin','superadmin'] %}
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/tasks/edit-tags">Edit Tags</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/tasks/google-sheets">Google Sheets</a></li>
                  {% endif %}
                </ul>
              </li>
              <li class="relative py-1" x-data="{open:false}">
                <button @click="open = !open" class="block px-4 py-2 text-blue-400 rounded hover:underline">Reports</button>
                <ul x-show="open" @click.away="open = false" class="absolute mt-2 bg-gray-800 text-white py-2 w-48 hidden" x-cloak>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/reports/vlan-usage">VLAN Usage</a></li>
                </ul>
              </li>
              <li class="relative py-1" x-data="{open:false}">
                <button @click="open = !open" class="block px-4 py-2 text-blue-400 rounded hover:underline">SSH</button>
                <ul x-show="open" @click.away="open = false" class="absolute mt-2 bg-gray-800 text-white py-2 w-48 hidden" x-cloak>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/ssh/port-config">Port Config</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/ssh/port-check">Port Check</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/ssh/config-check">Config Check</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/ssh/port-search">Port Search</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/ssh/bulk-port-update">Bulk Port Update</a></li>
                  <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/bulk/vlan-push">VLAN Bulk Push</a></li>
                <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/ssh/netbird-connect">Initiate Netbird Connection</a></li>
                </ul>
              </li>
              {% if current_user and current_user.role in ['editor','admin','superadmin'] %}
              <li class="py-1">
                <a class="block px-4 py-2 text-blue-400 rounded hover:underline" href="/bulk/device-import">Bulk Add Devices</a>
              </li>
              {% endif %}
            </ul>
            <div class="flex items-center">
              {% if current_user %}
                <a class="text-blue-400 underline mr-2" href="/dashboard">Dashboard</a>
                <a class="text-blue-400 underline mr-2" href="/users/me">My Profile</a>
                <a class="text-blue-400 underline mr-2" href="/user/ssh">SSH Profiles</a>
                {% if current_user.role in ['admin','superadmin'] %}
                <div class="relative py-1 mr-2" x-data="{open:false}">
                  <button @click="open = !open" class="px-4 py-2 text-blue-400 border rounded hover:bg-gray-700">
                    {{ 'Super Admin' if current_user.role == 'superadmin' else 'Admin' }}
                  </button>
                  <ul x-show="open" @click.away="open = false" class="absolute right-0 mt-2 bg-gray-800 text-white py-2 w-48 hidden" x-cloak>
                    {% if current_user.role == 'superadmin' %}
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/tunables">Tunables</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/ssh">SSH Credentials</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/snmp">SNMP Credentials</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/device-types">Device Types</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/tags">Tag Manager</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/locations">Locations</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/bulk/device-import">Device Import</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/audit">Audit Log</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/ip-bans">IP Bans</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/users">User Management</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/debug">Debug Logs</a></li>
                    {% else %}
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/ssh">SSH Credentials</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/snmp">SNMP Credentials</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/device-types">Device Types</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/admin/locations">Locations</a></li>
                    <li><a class="block px-4 py-2 text-blue-400 rounded hover:bg-gray-700" href="/bulk/device-import">Device Import</a></li>
                    {% endif %}
                  </ul>
                </div>
                {% endif %}
                <a href="/auth/logout" class="text-blue-400 underline">Logout</a>
              {% else %}
                <a href="/auth/login" class="text-blue-400 underline">Login</a>
              {% endif %}
            </div>
          </div>
        </div>
      </nav>
      {% endblock %}
    </header>
    <div class="container mt-4">
      <a href="javascript:history.back()" class="text-blue-400 underline">&laquo; Back</a>
      <p>{{ message }}</p>
      {% block content %}{% endblock %}
    </div>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    {% block extra_scripts %}{% endblock %}
  </body>
</html>

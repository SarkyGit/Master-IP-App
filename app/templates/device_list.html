{% extends "base.html" %}

{% block content %}
<h1 class="text-xl mb-4">Devices</h1>
{% if current_user and current_user.role in ['editor','admin','superadmin'] %}
  <a href="/devices/new" class="underline">Add Device</a>
{% endif %}
{% if current_user and current_user.role == 'superadmin' %}
  <form method="post" action="/admin/run-push-queue" style="display:inline">
    <button type="submit" class="ml-2">ðŸ”„ Run Push Queue Now</button>
  </form>
{% endif %}
<table class="min-w-full bg-gray-800">
  <thead>
    <tr>
      <th class="px-4 py-2 text-left">Hostname</th>
      <th class="px-4 py-2 text-left">IP</th>
      <th class="px-4 py-2 text-left">Model</th>
      <th class="px-4 py-2 text-left">Status</th>
      <th class="px-4 py-2 text-left">VLAN</th>
      <th class="px-4 py-2 text-left">SSH Profile</th>
      <th class="px-4 py-2 text-left">SNMP Profile</th>
      {% if current_user and current_user.role in ['editor','admin','superadmin'] %}
      <th></th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
  {% for device in devices %}
    <tr class="border-t border-gray-700">
      <td class="px-4 py-2">{{ device.hostname }}</td>
      <td class="px-4 py-2">{{ device.ip }}</td>
      <td class="px-4 py-2">{{ device.model or '' }}</td>
      <td class="px-4 py-2">{{ device.status or '' }}</td>
      <td class="px-4 py-2">{{ device.vlan.tag if device.vlan else '' }}</td>
      <td class="px-4 py-2">{{ device.ssh_credential.name if device.ssh_credential else '' }}</td>
      <td class="px-4 py-2">{{ device.snmp_community.name if device.snmp_community else '' }}</td>
      {% if current_user and current_user.role in ['editor','admin','superadmin'] %}
      <td class="px-4 py-2">
        <a href="/devices/{{ device.id }}/edit" class="text-blue-400 underline mr-2">Edit</a>
        <form method="post" action="/devices/{{ device.id }}/delete" style="display:inline">
          <button type="submit" class="text-red-400 underline" onclick="return confirm('Delete device?')">Delete</button>
        </form>
        <form method="post" action="/devices/{{ device.id }}/pull-config" style="display:inline">
          <button type="submit" class="text-green-400 underline ml-2">Pull Config</button>
        </form>
        <a href="/devices/{{ device.id }}/push-config" class="text-purple-400 underline ml-2">Push Config</a>
        <a href="/devices/{{ device.id }}/configs" class="text-yellow-400 underline ml-2">Configs</a>
        {% if device.snmp_community %}
        <a href="/devices/{{ device.id }}/ports" class="text-indigo-400 underline ml-2">Port Status</a>
        {% endif %}
      </td>
      {% endif %}
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
